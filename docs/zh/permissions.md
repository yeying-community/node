# 权限模型

本节描述当前后端的权限模型与授权边界（以现有实现为准）。

## 认证层（已实现）
- 所有 `/api/v1/*` 业务接口默认要求 `Authorization: Bearer <token>`。
- 允许两种 token：
  - **SIWE (JWT)**
  - **UCAN**（需满足 `aud` + `cap`）

## UCAN 授权规则（已实现）
服务端严格校验：
- `aud` == `UCAN_AUD`（完全匹配）
- capability 包含 `{ resource: UCAN_RESOURCE, action: UCAN_ACTION }`
- `exp` 未过期、证明链有效

> 注意：前端必须生成与后端 `UCAN_AUD` 完全一致的 audience，否则返回 `UCAN audience mismatch`。

## 角色与用户状态（已定义）
用户状态与角色在接口协议中有枚举定义，但目前**未被强制使用**：
- `UserRoleEnum`: `OWNER`, `NORMAL`, `UNKNOWN`
- `UserStatusEnum`: `ACTIVE`, `OFFLINE`, `DISABLE`, `LOCK`, `AUDIT`, `REFUSED`, ...

## 当前实际授权边界（现状）
- **已生效**：Token 必须通过（JWT/UCAN）。
- **未强制**：角色/状态与细粒度权限控制（目前业务接口基本不校验用户角色）。
- **签名校验**：与 `@yeying-community/yeying-web3` 相关的签名/身份校验已停用（no-op）。

## 权限缺口与待办（建议优先级）
1. **角色校验**：将 `OWNER/NORMAL` 与审批、上下架等操作绑定。
2. **资源归属校验**：只允许资源 owner 更新/下架自身应用/服务。
3. **审核权限**：仅审批人/管理员可 approve/reject；记录审批人身份。
4. **用户状态控制**：冻结/解冻仅管理员可执行，冻结用户禁止发布/审批。
5. **签名校验恢复**：若要恢复强校验，需要重新引入加密/签名库或替代方案。
6. **在线状态约束**：上线需审核通过，搜索默认仅返回已上线资源。

## 推荐的目标权限模型（规划）
以下是推荐的权限约束（可作为后续开发目标）：

### 角色权限建议
- `OWNER`：审批/治理权限（审核、封禁、上下架）
- `NORMAL`：创建与管理自己的应用/服务、提交申请
- `UNKNOWN`：只读或拒绝

### 资源级权限建议
- **应用**：
  - 仅创建者可更新/下架
  - 审核通过后才能上线
- **服务**：
  - 仅创建者可更新/下架
  - 审核通过后才能上线
- **审核**：
  - 仅审核人/管理员可审批
- **用户状态**：
  - 仅管理员可冻结/解锁

> 说明：以上为规划建议，当前代码尚未强制执行。
